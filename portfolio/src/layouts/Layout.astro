---
import "../styles/global.css";
import Footer from "../components/general/Footer.astro";
import ThemeIcon from "../components/general/ThemeIcon.astro";
import Header from "../components/general/Header.astro";
import SectionContainer from "../components/general/SectionContainer.astro";

interface Props {
  title: string;
  description: string;
  showHeader?: boolean;
}

const { 
  title, 
  description,
  showHeader = true 
} = Astro.props;
---

<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={description} />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
  </head>

  <body class="flex flex-col min-h-screen w-full dark:bg-[#000000] dark:bg-[radial-gradient(#ffffff33_1px,#00091d_1px)] bg-[#f5f7ff] bg-[radial-gradient(#3b82f680_1px,#f8fafc_1px)] bg-[size:20px_20px] transition-colors duration-300">
    
    {showHeader && (
      <SectionContainer id="header" fullWidth={true}>
        <Header />
      </SectionContainer>
    )}

    <div class="flex-1">
      <slot />
    </div>
    
    <Footer />
  
    <script>
      // Script optimizado para destacar la navegación activa
      document.addEventListener('DOMContentLoaded', () => {
        // Seleccionar todos los enlaces de navegación y secciones
        const navLinks = document.querySelectorAll('nav a[href^="#"]');
        const sections = document.querySelectorAll('section[data-section]');
        
        if (sections.length > 0 && navLinks.length > 0) {
          // Por defecto, destaca el primer enlace
          const firstLink = navLinks[0];
          firstLink.classList.add('nav-active', 'text-white', 'font-medium');
          firstLink.classList.remove('text-gray-300');
          
          // Configura el Intersection Observer para detectar cuándo una sección es visible
          const observerOptions = {
            root: null, // viewport
            rootMargin: '-50px 0px -50% 0px', // Margen ajustado para mejor precisión
            threshold: 0.1 // 10% de la sección debe ser visible
          };
          
          const observer = new IntersectionObserver((entries) => {
            // Filtra las entradas que están intersectando
            const visibleSections = entries.filter(entry => entry.isIntersecting);
            
            // Si hay secciones visibles, actualiza la navegación
            if (visibleSections.length > 0) {
              // Toma la primera sección visible (la más alta en la página)
              const sectionId = visibleSections[0].target.getAttribute('data-section');
              
              // Actualiza las clases en los enlaces de navegación
              navLinks.forEach(link => {
                const href = link.getAttribute('href').substring(1); // Quita el #
                
                if (href === sectionId) {
                  // Activa el enlace correspondiente a la sección visible
                  link.classList.add('nav-active', 'text-white', 'font-medium');
                  link.classList.remove('text-gray-300');
                } else {
                  // Desactiva los demás enlaces
                  link.classList.remove('nav-active', 'text-white', 'font-medium');
                  link.classList.add('text-gray-300');
                }
              });
            }
          }, observerOptions);
          
          // Observa todas las secciones
          sections.forEach(section => {
            observer.observe(section);
          });
        }
      });
    </script>
  </body>
</html>